<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Base64 编解码 - 在线工具集</title>
  <link rel="stylesheet" href="../css/common.css">
</head>
<body>
  <header class="site-header">
    <div class="container">
      <a href="../index.html" class="logo">在线工具集</a>
      <nav class="nav">
        <a href="../index.html">首页</a>
      </nav>
    </div>
  </header>

  <main class="site-main container tool-page">
    <a href="../index.html" class="back">← 返回首页</a>
    <h1>Base64 编解码</h1>
    <p class="lead">支持中文与 Emoji。编码输出 Base64，或将 Base64 解码为文本。</p>

    <div class="tool-card">
      <h3>输入</h3>
      <div class="form-group">
        <label for="input">文本 / Base64</label>
        <textarea id="input" class="w-full" placeholder="输入要编码或解码的内容"></textarea>
      </div>
      <button type="button" class="btn" id="btnEncode">编码</button>
      <button type="button" class="btn btn-secondary" id="btnDecode" style="margin-left: 0.5rem;">解码</button>
      <button type="button" class="btn btn-secondary" id="btnClear" style="margin-left: 0.5rem;">清空</button>
      <p id="msg" style="margin-top: 0.75rem; font-size: 0.9rem; color: var(--text-muted);"></p>
    </div>

    <div class="tool-card">
      <h3>输出</h3>
      <div class="form-group">
        <label for="output">结果</label>
        <textarea id="output" class="w-full" readonly placeholder="这里显示结果"></textarea>
      </div>
      <button type="button" class="btn" id="btnCopy">复制结果</button>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>纯前端工具，数据仅在本机处理，不经过服务器。</p>
    </div>
  </footer>

  <script>
    (function () {
      var inputEl = document.getElementById('input');
      var outputEl = document.getElementById('output');
      var msgEl = document.getElementById('msg');
      var btnEncode = document.getElementById('btnEncode');
      var btnDecode = document.getElementById('btnDecode');
      var btnClear = document.getElementById('btnClear');
      var btnCopy = document.getElementById('btnCopy');

      function setMsg(text) {
        msgEl.textContent = text || '';
      }

      function encodeUtf8ToBase64(str) {
        var bytes = new TextEncoder().encode(str);
        var bin = '';
        for (var i = 0; i < bytes.length; i++) bin += String.fromCharCode(bytes[i]);
        return btoa(bin);
      }

      function decodeBase64ToUtf8(b64) {
        var bin = atob(b64);
        var bytes = new Uint8Array(bin.length);
        for (var i = 0; i < bin.length; i++) bytes[i] = bin.charCodeAt(i);
        return new TextDecoder().decode(bytes);
      }

      function doEncode() {
        setMsg('');
        var text = inputEl.value || '';
        outputEl.value = encodeUtf8ToBase64(text);
        setMsg('已编码。');
      }

      function doDecode() {
        setMsg('');
        var text = (inputEl.value || '').trim();
        if (!text) {
          outputEl.value = '';
          setMsg('请输入 Base64。');
          return;
        }
        try {
          outputEl.value = decodeBase64ToUtf8(text);
          setMsg('已解码。');
        } catch (e) {
          outputEl.value = '';
          setMsg('解码失败：Base64 格式不正确。');
        }
      }

      async function copyOutput() {
        var v = outputEl.value || '';
        if (!v) return;
        try {
          await navigator.clipboard.writeText(v);
          setMsg('已复制到剪贴板。');
        } catch (e) {
          outputEl.focus();
          outputEl.select();
          document.execCommand('copy');
          setMsg('已复制到剪贴板。');
        }
      }

      btnEncode.addEventListener('click', doEncode);
      btnDecode.addEventListener('click', doDecode);
      btnClear.addEventListener('click', function () {
        inputEl.value = '';
        outputEl.value = '';
        setMsg('');
      });
      btnCopy.addEventListener('click', copyOutput);
    })();
  </script>
</body>
</html>
